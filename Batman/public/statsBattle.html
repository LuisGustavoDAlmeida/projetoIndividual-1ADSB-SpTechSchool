<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../public/css/statsBattle.css">
</head>

<body>
    <main>
        <section class="equipaments">
            <div class="general-equip">
                <div class="loadout">
                    <img id="batrang" class="weapon" src="./assets/imgs/equipaments/batrangs.png">
                    <!-- <span>Batarang</span> -->
                    <img id="shockWeapon" class="weapon" src="./assets/imgs/equipaments/dischargeWeapon.webp">
                    <!-- <span>Arma de eletricidade</span> -->
                    <img id="sword" class="weapon" src="./assets/imgs/equipaments/batSword.jpg">
                    <!-- <span>Espada</span> -->
                    <img id="smokeBomb" class="weapon" src="./assets/imgs/equipaments/smokeBomb.webp">
                    <!-- <span>Bomba de fumaça</span> -->
                    <img id="armor" class="armor" src="./assets/imgs/equipaments/batArmor.webp">
                    <!-- <span>Armadura</span> -->
                    <img id="cloak" class="armor" src="./assets/imgs/equipaments/batCloak.jpg">
                    <!-- <span>Capa</span> -->
                    <img id="gloves" class="armor" src="./assets/imgs/equipaments/batGloves.webp">
                    <!-- <span>Luvas</span> -->
                    <img id="gasMask" class="armor" src="./assets/imgs/equipaments/gasMask.webp">
                    <!-- <span>Máscara de gás</span> -->
                </div>
                <div class="buttons">
                    <button onclick="inventory()"> Ver inventário?</button>
                    <button onclick="clearBelt()">Reescolher itens?</button>
                    <button onclick="confirmItens()">Registrar no banco de dados da WayneTech?</button>
                    <button onclick="getItens()">Avançar para a batalha?</button>
                </div>
                <div id="div_stats"></div>
            </div>
            <div class="butler">
                <div class="alfred">
                    <img src="./assets/imgs/equipaments/alfredPennyworth.webp" alt="">
                </div>
                <div class="central-title">
                    <h1 id="div_name"></h1>
                </div>
            </div>
        </section>
    </main>
</body>

</html>

<script>
    const username = sessionStorage.USERNAME_USUARIO;
    const id = sessionStorage.ID_USUARIO;
    div_name.innerHTML = `Olá ${username}, você irá ajudar o patrão Bruce desta vez? Por favor escolha os seus equipamentos ao lado:`;
    const weaponry = document.querySelectorAll(".weapon");
    const armory = document.querySelectorAll(".armor");
    console.log(id);
    var equipLoad = 0;
    var names = [];
    var damages = [];
    var defenses = [];
    var evasions = [];
    var selectedEquipament = 0;

    weaponry.forEach((weaponry, index) => {
        weaponry.addEventListener("click", function selectWeapon() {
            if (equipLoad < 3) {
                if (index === 0) {
                    div_name.innerHTML = `Você selecionou os Batrangs? Boa escolha.`;
                    names.push("Batrang");
                    damages.push(100);
                    defenses.push(0);
                    evasions.push(0);
                    // batBelt.push(weaponry[index]);
                } else if (index === 1) {
                    div_name.innerHTML = `Uma arma de eletricidade? Parece perfeita para eletrizar seus inimigos.`;
                    names.push("Arma de Eletricidade");
                    damages.push(20);
                    defenses.push(0);
                    evasions.push(0);
                } else if (index === 2) {
                    div_name.innerHTML = `Uma espada, o que isto está fazendo aqui? Não é do feitio do patrão Bruce escolher este tipo de arma, porém funciona muito bem.`;
                    names.push("Espada");
                    damages.push(150);
                    defenses.push(25);
                    evasions.push(0);
                } else if (index === 3) {
                    div_name.innerHTML = `Bombas de fumaça? Se você gosta de furtividade, isto é essencial.`;
                    names.push("Bomba de fumaça");
                    damages.push(0);
                    defenses.push(0);
                    evasions.push(100);
                }
                equipLoad++;
            } else {
                div_name.innerHTML = `Parece que o seu cinto de utilidades está cheio, por favor esvazie ele apertando no botão se for do seu desejo.`;
            }
        });
    });
    armory.forEach((armory, index) => {
        armory.addEventListener("click", function selectArmor() {
            if (equipLoad < 3) {
                if (index === 0) {
                    div_name.innerHTML = `Uma armadura? Proteção demais, nunca é demais.`;
                    names.push("Armadura");
                    damages.push(0);
                    defenses.push(75);
                    evasions.push(0);
                } else if (index === 1) {
                    div_name.innerHTML = `Uma capa? Não pode faltar no kit de um morcego.`;
                    names.push("Capa");
                    damages.push(0);
                    defenses.push(25);
                    evasions.push(100);
                } else if (index === 2) {
                    div_name.innerHTML = `Um par de luvas? Entendi, não quer machucar as suas mãos enquanto você bate em seus inimigos.`;
                    names.push("Luvas");
                    damages.push(25);
                    defenses.push(25);
                    evasions.push(25);
                } else if (index === 3) {
                    div_name.innerHTML = `Não sei qual seria a utilidade deste item... Mas se é da sua escolha, não irei impedi-lo.`
                    names.push("Máscara de gás");
                    damages.push(0);
                    defenses.push(0);
                    evasions.push(0);
                }
                equipLoad++;
            } else {
                div_name.innerHTML = `Parece que o seu cinto de utilidades está cheio, por favor esvazie ele apertando no botão se for do seu desejo.`;
            }
        });
    });
    function inventory() {
        div_stats.innerHTML = ``;
        for (var counter = 0; counter < equipLoad; counter++) {
            // var totalDamage = 0;
            // var totalDefense = 0;
            // var totalEvasion = 0;
            // totalDamage = damages[counter];
            // totalDefense = defenses[counter];
            // totalEvasion = evasions[counter];
            // var totalDefense
            // var totalEvasion
            div_name.innerHTML = `Estes são os equipamentos que você escolheu e os seus status.`
            div_stats.innerHTML += `<h1> ${names[counter]} </h1> <br>
            Dano: ${damages[counter]} <br>
            Defesa: ${defenses[counter]} <br>
            Evasão: ${evasions[counter]} <br>
            `;
        }
    }
    function clearBelt() {
        div_stats.innerHTML = ``;
        equipLoad = 0;
        names = [];
        damages = [];
        defenses = [];
        evasions = [];
        inventory();
    }
    function confirmItens() {
        var totalDamage = 0;
        var totalDefense = 0;
        var totalEvasion = 0;

        for (var counter = 0; counter < equipLoad; counter++) {
            totalDamage += damages[counter];
            totalDefense += defenses[counter];
            totalEvasion += evasions[counter];
        }
        if (equipLoad == 3) {
            div_stats.innerHTML = ` <br>
        <h1> Status do Personagem </h1> </br>
            HP: ${totalDefense + totalEvasion} <br>
            Dano Total: ${totalDamage} <br>
            Defesa Total: ${totalDefense}<br>
            Evasão Total: ${totalEvasion}<br>
            `
            var equip1 = names[0];
            var equip2 = names[1];
            var equip3 = names[2];
            var dataBaseHP = totalDefense + totalEvasion;
            var dataBaseDamage = totalDamage;
            var dataBaseDefense = totalDefense;
            var dataBaseEvasion = totalEvasion;
            selectedEquipament = 1;
            // databaseServer 
            fetch("/statsBattle/confirmItens", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    equip1Server: equip1,
                    equip2Server: equip2,
                    equip3Server: equip3,
                    hpServer: dataBaseHP,
                    damageServer: dataBaseDamage,
                    defenseServer: dataBaseDefense,
                    evasionServer: dataBaseEvasion,
                    idServer: id,
                }),
            })
            // CRIAR A ROTA AQUI
        } else if (equipLoad == 3) {
            div_name.innerHTML = `Você precisa escolher até 3 equipamentos.`;
        } else if (selectedEquipament == 1) {
            div_name.innerHTML = `Parece que seus equipamentos já estão selecionados.`;
        }
    }
    function getItens() {
        if (names.length === 0) {
            div_name.innerHTML = `Você não pode ir para a batalha sem equipamentos.`;
        } else if (id == undefined) {
            div_name.innerHTML = `Como você passou pela entrada da Batcaverna sem se registrar? O patrão não irá ficar nada feliz.`
        }
        else {
            div_name.innerHTML = `Você será redirecionado em breve, vale lembrar que você só pode selecionar 1 arsenal.`

            fetch("/statsBattle/getItens/" + id, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                },
            }).then(function (resposta) {
                resposta.json().then(resposta => {
                    setTimeout(function () {
                        console.log("Redirecionando")
                        window.location = "./battlePage.html";
                    }, 5000);
                    console.log(resposta);
                })
            })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                });
        }
    }

    // FAZER UM DELETE NESSA PÁGINA PRA CASO ELE JÁ TENHA REGISTRADO;
</script>